<!DOCTYPE html>
<html>
  <head>
  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TweetMap</title>
    <style>
      #map-canvas {
		width:66.6666%;
    	height:100%;
    	position:absolute;
    	right:16px;
    	top:250px;
    	bottom:10px;
      }
      
      #panel {
      	position:absolute;
        width:380px;
        left:15px;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&signed_in=true&libraries=visualization"></script>
    
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


    <script>
	var map, pointarray, heatmap;
	//var wsUri = "ws://localhost:8090/TwittMap/map"
	var wsUri="ws://ec2-54-164-205-69.compute-1.amazonaws.com:8080/map";
	var taxiData;
	var websocket;
	var init_time=24*60*60;
	//var pointArray;
	//var pointArray_sports;
	//var pointArray_IT;
	//var pointArray_media;
    
    function onOpen(evt) {
    	websocket.send(init_time);
    	//writeToScreen("Open success!");
    }
    var count = 0;
    function onMessage(evt) {
    	var data=JSON.parse(evt.data);
    	
		pointArray.push(new google.maps.LatLng(data.lat,data.lon));
		
    	if(data.kw=="sports"){
    		pointArray_sports.push(new google.maps.LatLng(data.lat,data.lon));
    	}else if(data.kw=="IT"){
    		pointArray_IT.push(new google.maps.LatLng(data.lat,data.lon));
    	}else if(data.kw=="media"){
    		pointArray_media.push(new google.maps.LatLng(data.lat,data.lon));
    	}
    	/*
    	count = count + 1;
    	writeToScreen(count);
    	/*
    	document.getElementById("check").innerHTML=pointArray.length;
    	document.getElementById("check1").innerHTML=pointArray_sports.length;
    	document.getElementById("check2").innerHTML=pointArray_IT.length;
    	document.getElementById("check3").innerHTML=pointArray_media.length;*/
    	
    }
    function onError(evt) {
    	writeToScreen(evt.data);
		writeToScreen("Error!");
    }
    
    function filter(){
    	var val=document.getElementById("filter").value;
    	
    	switch (val) {
    		case "all":
    			heatmap.setMap(map);
    			heatmap_IT.setMap(null);
    			heatmap_sports.setMap(null);
    			heatmap_media.setMap(null);
    			break;
    		case "IT":
    			heatmap_IT.setMap(map);
    			heatmap.setMap(null);
    			heatmap_sports.setMap(null);
    			heatmap_media.setMap(null);
    			break;
    		case "sports":
    			heatmap_sports.setMap(map);
    			heatmap_IT.setMap(null);
    			heatmap.setMap(null);
    			heatmap_media.setMap(null);
    			break;
    		case "media":
    			heatmap_media.setMap(map);
    			heatmap_IT.setMap(null);
    			heatmap_sports.setMap(null);
    			heatmap.setMap(null);
    			break;
    	}
    }

	function initialize() {
		
		websocket=new WebSocket(wsUri);
		//document.getElementById("test").innerHTML=websocket;
		websocket.onopen=function(evt){
			onOpen(evt);
			//document.getElementById("test").innerHTML="another test!!";
		}
		websocket.onmessage=function(evt){
			//writeToScreen("Trying to connect!");
			onMessage(evt);
		}
		websocket.onerror=function(evt){
			onError(evt);
		}
		var mapOptions = {
    		zoom: 2,
    		center: new google.maps.LatLng(0, 0),
    		mapTypeId: google.maps.MapTypeId.SATELLITE
		};

		map = new google.maps.Map(document.getElementById('map-canvas'),mapOptions);
		
		pointArray = new google.maps.MVCArray(taxiData);
		pointArray_sports = new google.maps.MVCArray(taxiData);
		pointArray_IT = new google.maps.MVCArray(taxiData);
		pointArray_media = new google.maps.MVCArray(taxiData);
		
		heatmap = new google.maps.visualization.HeatmapLayer({data: pointArray});
		heatmap_sports = new google.maps.visualization.HeatmapLayer({data: pointArray_sports});
		heatmap_IT=new google.maps.visualization.HeatmapLayer({data: pointArray_IT});
		heatmap_media=new google.maps.visualization.HeatmapLayer({data: pointArray_media});
		
		heatmap.setMap(map);
		/*
		heatmap_sports.setMap(map);
		heatmap_IT.setMap(map);
		heatmap_media.setMap(map);*/
	}
	/*
	function toggleHeatmap() {
		heatmap.setMap(heatmap.getMap() ? null : map);
	}
	
	function changeGradient() {
		var gradient = [
    	'rgba(0, 255, 255, 0)',
    	'rgba(0, 255, 255, 1)',
    	'rgba(0, 191, 255, 1)',
    	'rgba(0, 127, 255, 1)',
    	'rgba(0, 63, 255, 1)',
    	'rgba(0, 0, 255, 1)',
    	'rgba(0, 0, 223, 1)',
    	'rgba(0, 0, 191, 1)',
    	'rgba(0, 0, 159, 1)',
    	'rgba(0, 0, 127, 1)',
    	'rgba(63, 0, 91, 1)',
    	'rgba(127, 0, 63, 1)',
    	'rgba(191, 0, 31, 1)',
    	'rgba(255, 0, 0, 1)'
  		]	
		heatmap.set('gradient', heatmap.get('gradient') ? null : gradient);
	}
	
	function changeRadius() {
		heatmap.set('radius', heatmap.get('radius') ? null : 20);
	}	
	function changeOpacity() {
		heatmap.set('opacity', heatmap.get('opacity') ? null : 0.2);
	}
	*/
	function writeToScreen(message) {
        var pre = document.createElement("p");
        pre.style.wordWrap = "break-word";
        pre.innerHTML = message;
        output.appendChild(pre);
    }
	
	google.maps.event.addDomListener(window, 'load', initialize);
    setInterval(function() {
    	//console.log("test");
    	websocket.send(1);
    }, 1000*1);

    </script>
  </head>

  <body>
  <div class="container-fluid">
    <div class="jumbotron">
    <h1>Twitter Map</h1> 
    <p>This web application can show real time number of tweets all over the world in form of heatmap</p> 
  	</div>
    
  </div>
      <div id="panel">
        <h2>Keywords Filter</h2>
        <br>
        <br>
        <select id="filter" class="form-control" onChange="filter()">
      	  <option value="all"> ALL </option>
      	  <option value="sports"> SPORTS </option>
      	  <option value="IT"> IT </option>
      	  <option value="media"> MEDIA </option>
        </select>   
      </div>

  <div id="map-canvas">test</div>
  </body>
</html>